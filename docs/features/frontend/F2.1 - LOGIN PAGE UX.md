# F2.1 ‚Äî Login Page & UX

## üéØ Objetivo

Entregar uma **p√°gina de login completa, robusta e pronta para uso real**, funcionando como o **ponto de entrada oficial** da aplica√ß√£o Agronomia.

A F2.1 consolida o fluxo de autentica√ß√£o iniciado na Fase 0 e refinado na Fase 1, agora com foco em **experi√™ncia do usu√°rio, feedback claro e previsibilidade de navega√ß√£o**.

---

## üß† Contexto

Infra j√° dispon√≠vel no frontend:

* `AuthApiService` com `login()`
* `AuthTokenService` para persist√™ncia do token
* `CurrentUserStore` para carregar o usu√°rio autenticado e suas organiza√ß√µes
* `ActiveOrganizationStore` para contexto organizacional
* Interceptors (F0.4 / F1.1):

  * token
  * organiza√ß√£o ativa
  * tratamento global de erros
* Guards (F1.2):

  * autentica√ß√£o
  * organiza√ß√£o ativa
  * papel (role)

O login existente atualmente √© **funcional**, por√©m carece de:

* valida√ß√µes consistentes
* mensagens de erro claras
* estados visuais (loading, disabled)
* fluxo expl√≠cito de navega√ß√£o p√≥s-login

A F2.1 resolve essas lacunas.

---

## üìå Escopo Funcional

### 1. Formul√°rio de Login

Campos obrigat√≥rios:

| Campo             | Tipo  | Regras      |
| ----------------- | ----- | ----------- |
| `emailOrUserName` | texto | obrigat√≥rio |
| `password`        | senha | obrigat√≥rio |

Requisitos:

* formul√°rio reativo
* valida√ß√£o imediata (on blur / on submit)
* mensagens de erro por campo

---

### 2. Estados de UI

A tela de login deve suportar claramente os seguintes estados:

* **Idle** ‚Äî formul√°rio edit√°vel
* **Submitting** ‚Äî requisi√ß√£o em andamento
* **Error** ‚Äî erro retornado pelo backend

Comportamentos esperados:

* bot√£o "Entrar" desabilitado quando o formul√°rio for inv√°lido
* bot√£o "Entrar" desabilitado durante submiss√£o
* indicador visual de loading durante a autentica√ß√£o

---

### 3. Fluxo de Autentica√ß√£o

Fluxo completo esperado:

1. Usu√°rio preenche formul√°rio e submete
2. Frontend chama `AuthApiService.login(credentials)`
3. Em caso de sucesso:

   * token √© salvo via `AuthTokenService.setToken()`
   * `CurrentUserStore.loadFromApi()` √© executado
4. Ap√≥s carregar o usu√°rio:

   * se **n√£o existir organiza√ß√£o ativa** ‚Üí navegar para `/select-organization`
   * se **j√° existir organiza√ß√£o ativa v√°lida** ‚Üí navegar para `/` (dashboard padr√£o)

---

### 4. Tratamento de Erros

Erros devem ser exibidos de forma **clara, humana e n√£o t√©cnica**.

Casos m√≠nimos a tratar:

| Situa√ß√£o                    | Comportamento                                |
| --------------------------- | -------------------------------------------- |
| Credenciais inv√°lidas (401) | Exibir mensagem "Usu√°rio ou senha inv√°lidos" |
| Usu√°rio bloqueado/inativo   | Exibir mensagem espec√≠fica, se fornecida     |
| Erro de rede / 5xx          | Exibir mensagem gen√©rica de falha tempor√°ria |

Regras adicionais:

* n√£o exibir stack trace ou mensagens t√©cnicas
* n√£o limpar o campo `emailOrUserName`
* opcionalmente limpar apenas o campo `password`

---

## üåä Fluxos de Navega√ß√£o

### Fluxo A ‚Äî Login bem-sucedido com m√∫ltiplas organiza√ß√µes

* Login ‚Üí `/select-organization`
* Usu√°rio escolhe organiza√ß√£o
* App navega para dashboard correspondente

### Fluxo B ‚Äî Login bem-sucedido com organiza√ß√£o √∫nica

* Login ‚Üí organiza√ß√£o √© auto-selecionada
* App navega diretamente para `/`

### Fluxo C ‚Äî Login inv√°lido

* Login falha
* Usu√°rio permanece na tela de login
* Mensagem de erro exibida

---

## üé® UX / UI Guidelines

* Tela simples e focada
* Mensagens claras e curtas
* Evitar distra√ß√µes visuais
* Layout responsivo (desktop-first, mobile-friendly)

> **Nota:** identidade visual final n√£o √© objetivo desta fase; clareza funcional √© prioridade.

---

## üß± Componentes Envolvidos

* `public/login/login.component.ts`
* `public/login/login.component.html`
* `public/login/login.component.scss`
* `AuthApiService`
* `AuthTokenService`
* `CurrentUserStore`
* `ActiveOrganizationStore`

---

## ‚úÖ Crit√©rios de Aceite (mais espec√≠ficos)

**Formul√°rio**

* [ ] N√£o √© poss√≠vel submeter com campos vazios
* [ ] Campos inv√°lidos exibem mensagens de erro claras

**Submiss√£o**

* [ ] Durante submiss√£o:

  * [ ] bot√£o "Entrar" fica desabilitado
  * [ ] indicador visual de loading √© exibido

**Sucesso**

* [ ] Token √© persistido corretamente
* [ ] `CurrentUserStore` √© carregado ap√≥s login
* [ ] Navega√ß√£o p√≥s-login respeita o contexto de organiza√ß√£o

**Erro**

* [ ] Credenciais inv√°lidas exibem mensagem amig√°vel
* [ ] Erros de rede exibem mensagem gen√©rica
* [ ] Usu√°rio permanece na tela de login ap√≥s erro

**N√£o regress√£o**

* [ ] Rotas protegidas continuam inacess√≠veis sem login
* [ ] Refresh da p√°gina ap√≥s login mant√©m sess√£o v√°lida

---

## üß† Prompt de Implementa√ß√£o ‚Äî F2.1

Voc√™ √© um desenvolvedor Angular s√™nior atuando no projeto **Agronomia**.

Implemente a feature **F2.1 ‚Äî Login Page & UX** seguindo as diretrizes abaixo.

### Requisitos

1. Atualizar o componente de login para:

   * usar formul√°rio reativo com valida√ß√µes
   * exibir erros por campo
   * controlar estado de loading

2. Implementar o fluxo de autentica√ß√£o:

   * chamar `AuthApiService.login()`
   * salvar token via `AuthTokenService`
   * carregar usu√°rio com `CurrentUserStore.loadFromApi()`
   * decidir navega√ß√£o com base em `ActiveOrganizationStore`

3. Tratar erros retornados pelo backend:

   * mapear 401 para mensagem de credenciais inv√°lidas
   * tratar erros gen√©ricos com fallback amig√°vel

4. Garantir que a UX:

   * n√£o permita m√∫ltiplos submits simult√¢neos
   * mantenha formul√°rio consistente ap√≥s erro

### Entreg√°veis

* C√≥digo atualizado de `login.component.ts`, `.html` e `.scss`
* Eventuais ajustes m√≠nimos em servi√ßos/stores (se necess√°rio)
* Coment√°rios claros explicando decis√µes de fluxo

Mostre os arquivos finais do componente de login ap√≥s a implementa√ß√£o.
