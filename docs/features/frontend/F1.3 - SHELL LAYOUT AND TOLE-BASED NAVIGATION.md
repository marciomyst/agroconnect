## F1.3 ‚Äî Layout Shell & Role-Based Navigation

## üéØ Objetivo

Criar um **layout base consistente para o app autenticado**, com:

* topbar exibindo informa√ß√µes de contexto (usu√°rio + organiza√ß√£o)
* sidenav com menu din√¢mico por papel (Admin, Seller, Farmer)
* a√ß√µes globais: logout e trocar organiza√ß√£o

Isso d√° "cara de produto" e refor√ßa o modelo de m√∫ltiplos pap√©is e organiza√ß√µes.

---

## üß† Contexto Atual

J√° existem:

* `PublicLayoutComponent` ‚Üí usado em rotas p√∫blicas (login, select org, etc.).
* `AppLayoutComponent` ‚Üí usado em rotas autenticadas.

Ainda n√£o existem:

* topbar mostrando usu√°rio e organiza√ß√£o ativa
* menu lateral din√¢mico por papel
* a√ß√µes globais consistentes de logout/troca de organiza√ß√£o

---

## üìå Escopo Detalhado

1. **Topbar no `AppLayoutComponent`**

   * Exibir:

     * nome do usu√°rio (`CurrentUserStore.user`)
     * email (opcional)
     * nome da organiza√ß√£o ativa (`ActiveOrganizationStore.activeOrganization.name`)
     * tipo da organiza√ß√£o (√≠cone/label: Seller/Farm)
   * A√ß√µes de usu√°rio (menu ou bot√µes):

     * "Meu perfil" (rota futura)
     * "Trocar organiza√ß√£o" ‚Üí `/select-organization`
     * "Sair" ‚Üí chama fluxo de logout (limpa token/stores + `/login`)

2. **Sidenav com menu din√¢mico**

   * Estrutura sugerida de modelo de menu:

     ```ts
     interface NavItem {
       label: string;
       icon?: string;
       route: string;
       roles?: string[]; // opcional, se quiser filtrar tamb√©m por papel global
     }
     ```
   * Para cada contexto de papel:

     * **Admin**:

       * Dashboard Admin (`/admin`)
       * Gest√£o global (quando existir)
     * **Seller**:

       * Dashboard Seller (`/seller`)
       * Cat√°logo (`/seller/catalog`)
       * Membros/Organiza√ß√£o (`/seller/members`)
     * **Farmer**:

       * Dashboard Farmer (`/farmer`)
       * Membros/Organiza√ß√£o (`/farmer/members`)
   * O menu deve ler:

     * contexto atual de organiza√ß√£o (tipo)
     * pap√©is do usu√°rio naquela organiza√ß√£o
   * Renderizar apenas itens compat√≠veis com o contexto atual.

3. **Integra√ß√£o com stores**

   * `CurrentUserStore`:

     * fornece informa√ß√µes de usu√°rio (nome, email)
     * fornece conjunto de roles por organiza√ß√£o (se dispon√≠vel)
   * `ActiveOrganizationStore`:

     * fornece `activeOrganization`
     * helpers: `isSellerContext()`, `isFarmContext()`

4. **Fluxo de logout**

   * Implementado em um m√©todo `onLogout()` no `AppLayoutComponent`:

     * `AuthTokenService.clearToken()`
     * limpar `CurrentUserStore`
     * limpar `ActiveOrganizationStore`
     * navegar para `/login`

5. **Fluxo de troca de organiza√ß√£o**

   * A√ß√£o `onChangeOrganization()` no topo (link ou bot√£o):

     * navegar para `/select-organization`
     * n√£o limpar usu√°rio, apenas organiza√ß√£o ativa

---

## üåä Fluxos de Uso

1. **Usu√°rio logado entra no app**

   * Guarda passa (auth + org + role).
   * `AppLayoutComponent` √© renderizado.
   * Topbar mostra: "Ol√°, <nome>" + "Org: <org atual>".
   * Menu lateral mostra itens compat√≠veis com o papel/organiza√ß√£o.

2. **Usu√°rio clica em "Trocar organiza√ß√£o"**

   * Navega para `/select-organization`.
   * Ao escolher outra org, volta para `/` ou para rota previamente definida.
   * Layout atualiza nome da organiza√ß√£o e menu.

3. **Usu√°rio clica em "Sair"**

   * Sess√£o √© limpa (token + stores).
   * Navega√ß√£o para `/login`.

---

## ‚úÖ Crit√©rios de Aceite (mais espec√≠ficos)

**Topbar**

* [ ] Exibe nome do usu√°rio (ou fallback consistente quando ainda carregando).
* [ ] Exibe organiza√ß√£o ativa (nome) e tipo (Seller/Farm) quando dispon√≠vel.
* [ ] A√ß√£o **Trocar organiza√ß√£o** sempre navega para `/select-organization`.
* [ ] A√ß√£o **Sair**:

  * [ ] limpa token
  * [ ] limpa `CurrentUserStore`
  * [ ] limpa `ActiveOrganizationStore`
  * [ ] navega para `/login`

**Menu lateral**

* [ ] Menu renderiza itens conforme contexto:

  * [ ] Seller ‚Üí itens Seller (Dashboard, Cat√°logo stub, Membros)
  * [ ] Farmer ‚Üí itens Farmer (Dashboard, Membros)
  * [ ] Admin ‚Üí itens Admin (Dashboard)
* [ ] Ao trocar organiza√ß√£o, o menu atualiza sem recarregar a p√°gina.
* [ ] Item selecionado (ativo) reflete a rota atual.

**Layout / UX b√°sica**

* [ ] Conte√∫do do m√≥dulo aparece dentro do shell (router-outlet funciona corretamente).
* [ ] Layout n√£o depende de regras finas do dom√≠nio (apenas l√™ stores e navega).

**Verifica√ß√£o manual m√≠nima**

* [ ] Login ‚Üí sele√ß√£o de org ‚Üí dashboard: topbar e menu refletem o contexto correto.
* [ ] Trocar org: topbar e menu mudam para o novo contexto.
* [ ] Logout: retorna ao login e n√£o deixa acessar rotas protegidas com back/refresh.
