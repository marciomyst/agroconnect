Segue o texto completo do **F2.2 ‚Äî User Profile**, no mesmo padr√£o de F2.1/F1.x:

---

# F2.2 ‚Äî User Profile

## üéØ Objetivo

Entregar uma tela de **‚ÄúMeu Perfil‚Äù (User Profile)** que permita ao usu√°rio:

* visualizar informa√ß√µes b√°sicas da pr√≥pria conta
* (opcionalmente) atualizar campos edit√°veis, se expostos pelo backend

A F2.2 completa o ciclo de identidade no frontend, indo al√©m do login e permitindo que o usu√°rio **se reconhe√ßa** dentro do sistema e mantenha seus dados b√°sicos atualizados.

---

## üß† Contexto

Infra j√° existente:

* Autentica√ß√£o + token (`AuthTokenService`)
* Contexto do usu√°rio autenticado (`CurrentUserStore`)

  * cont√©m as informa√ß√µes principais do usu√°rio logado
* Contexto de organiza√ß√£o (`ActiveOrganizationStore`)

  * **n√£o √© foco direto** desta feature
* Interceptors e guards (F0/F1)

  * garantem que a rota de perfil s√≥ √© acess√≠vel por usu√°rio autenticado

Backend (assumido com base na Fase 1):

* Existe um endpoint para obter o usu√°rio autenticado (ex.: `/api/auth/me`)
  j√° integrado em `CurrentUserStore`.
* Pode existir (ou ser criado) um endpoint para atualizar dados b√°sicos do usu√°rio
  (ex.: `/api/users/me` com `PUT/PATCH`).

---

## üìå Escopo Funcional

### 1. Tela ‚ÄúMy Profile‚Äù

Criar uma tela acess√≠vel a partir de uma rota protegida, por exemplo:

* `/profile`
* ou `/settings/profile`

Conte√∫do m√≠nimo exibido:

| Campo          | Origem             | Edit√°vel? (depende do backend) |
| -------------- | ------------------ | ------------------------------ |
| Nome           | `CurrentUserStore` | Sim / N√£o                      |
| E-mail         | `CurrentUserStore` | Normalmente n√£o                |
| Username/Login | `CurrentUserStore` | Normalmente n√£o                |

Comportamento:

* Ao abrir a tela:

  * carregar dados diretamente do `CurrentUserStore` (evitar nova chamada redundante).
  * exibir estado de ‚Äúcarregando‚Äù caso o store ainda n√£o esteja pronto.

---

### 2. Modo Visualiza√ß√£o vs Edi√ß√£o

A tela pode trabalhar em um desses modelos:

**Modelo A ‚Äî Visualiza√ß√£o simples (se backend ainda n√£o suporta update):**

* Exibir os dados apenas como ‚Äúread-only‚Äù.
* Mostrar um resumo:

  * Nome
  * E-mail
  * Data de cria√ß√£o da conta (se dispon√≠vel)
* Futuramente pode ser extendida com edi√ß√£o.

**Modelo B ‚Äî Edi√ß√£o inline (se backend suportar):**

* Os campos edit√°veis (ex.: `Name`) ficam em inputs.
* Bot√£o ‚ÄúSalvar altera√ß√µes‚Äù:

  * desabilitado se n√£o houve mudan√ßa
  * exibe loading durante a requisi√ß√£o
* Em caso de sucesso:

  * Atualizar `CurrentUserStore` com os novos dados
  * Exibir mensagem de sucesso
* Em caso de erro:

  * Exibir mensagem clara de erro
  * Reverter campos se necess√°rio

> Este documento deve ser compat√≠vel com os dois cen√°rios. Se o backend ainda n√£o suportar edi√ß√£o, considerar apenas o **Modelo A** na implementa√ß√£o inicial.

---

### 3. Integra√ß√£o com CurrentUserStore

A tela **n√£o deve** chamar o backend diretamente para buscar o usu√°rio; deve confiar no `CurrentUserStore`.

Fluxo sugerido:

1. Ao iniciar o componente de perfil:

   * injetar `CurrentUserStore`
   * acessar `user()` via signal/computed ou getter equivalente
2. Se o store ainda estiver em modo ‚Äúloading‚Äù:

   * exibir spinner/placeholder
3. Assim que houver usu√°rio:

   * preencher os campos da tela com os dados do store

Se houver suporte a atualiza√ß√£o:

* Ap√≥s ‚ÄúSalvar‚Äù:

  * chamar um m√©todo de servi√ßo que:

    * envia as mudan√ßas ao backend
    * atualiza o `CurrentUserStore` com o resultado

---

### 4. Navega√ß√£o e Acesso

* A rota de ‚ÄúMy Profile‚Äù deve ser:

  * protegida pelo guard de autentica√ß√£o (`authCanMatch`)
  * **n√£o** exigir organiza√ß√£o ativa (√© um contexto global ao usu√°rio)
* Sugest√£o de rota:

  * `/profile`
  * Link acionado a partir da topbar (ex.: menu do usu√°rio em F1.3)

---

## üåä Fluxos de Uso

### Fluxo A ‚Äî Abrir perfil (visualiza√ß√£o)

1. Usu√°rio autenticado clica em ‚ÄúMy Profile‚Äù na topbar/menu.
2. Router navega para `/profile`.
3. Componente de perfil l√™ `CurrentUserStore`.
4. Tela exibe nome, e-mail e demais dados dispon√≠veis.

### Fluxo B ‚Äî Atualizar perfil (se houver edi√ß√£o)

1. Usu√°rio altera valor de um campo edit√°vel (ex.: nome).
2. Bot√£o ‚ÄúSalvar altera√ß√µes‚Äù √© habilitado.
3. Ao clicar em salvar:

   * bot√£o entra em loading
   * chamada ao servi√ßo de atualiza√ß√£o de perfil √© enviada
4. Em caso de sucesso:

   * `CurrentUserStore` √© atualizado
   * mensagem de sucesso √© exibida
5. Em caso de erro:

   * mensagem de erro exibida
   * campos voltam ao √∫ltimo estado consistente, ou mant√™m edi√ß√£o com indica√ß√£o do erro

---

## üé® UX / UI Guidelines

* Layout simples e organizado em se√ß√£o √∫nica:

  * t√≠tulo: ‚ÄúMy Profile‚Äù
  * subt√≠tulo curto: ‚ÄúManage your basic account information.‚Äù
* Informa√ß√µes sens√≠veis (senha) **n√£o** aparecem aqui ‚Äî ficam na tela de F2.3 (Security / Change Password)
* N√£o duplicar a√ß√µes:

  * link para ‚ÄúChange Password‚Äù pode apontar para rota da F2.3

---

## üß± Componentes Envolvidos

* Novo componente:

  * `src/app/profile/profile.component.ts` (ou equivalente em um m√≥dulo `settings/profile`)
* Layout:

  * integra com `AppLayoutComponent`
* Stores:

  * `CurrentUserStore`
* Servi√ßos:

  * Servi√ßo de perfil (caso seja necess√°rio um wrapper para update, ex.: `UserProfileApiService`)

---

## ‚úÖ Crit√©rios de Aceite (mais espec√≠ficos)

**Visualiza√ß√£o**

* [ ] Usu√°rio autenticado consegue acessar a rota de perfil a partir da aplica√ß√£o.
* [ ] Os dados exibidos na tela correspondem ao usu√°rio atual do `CurrentUserStore`.
* [ ] A tela lida com estado de ‚Äúcarregando‚Äù (sem flicker de dados indefinidos).

**Autoriza√ß√£o / Navega√ß√£o**

* [ ] Usu√°rio n√£o autenticado n√£o consegue acessar a rota de perfil (redirecionado para `/login`).
* [ ] A tela de perfil **n√£o exige** organiza√ß√£o ativa (n√£o redireciona para `/select-organization`).

**Atualiza√ß√£o (se implementada)**

* [ ] Campos edit√°veis s√≥ habilitam o bot√£o ‚ÄúSalvar‚Äù ao detectar mudan√ßas.
* [ ] Durante o salvamento:

  * [ ] bot√£o fica desabilitado
  * [ ] um estado de loading √© exibido
* [ ] Em caso de sucesso:

  * [ ] dados exibidos s√£o atualizados
  * [ ] uma mensagem de confirma√ß√£o √© mostrada
* [ ] Em caso de erro:

  * [ ] uma mensagem clara e amig√°vel √© exibida
  * [ ] o formul√°rio permanece em estado consistente (sem crash)

**N√£o regress√£o**

* [ ] Rotas protegidas existentes continuam funcionando normalmente.
* [ ] Voltar da tela de perfil para outras rotas n√£o quebra o contexto de usu√°rio/organiza√ß√£o.

---

## üß† Prompt de Implementa√ß√£o ‚Äî F2.2

Voc√™ √© um desenvolvedor Angular s√™nior atuando no projeto **Agronomia**.

Implemente a feature **F2.2 ‚Äî User Profile (My Profile)** seguindo as diretrizes abaixo.

### Contexto t√©cnico

* O usu√°rio autenticado j√° est√° dispon√≠vel via `CurrentUserStore`.
* A tela de perfil n√£o depende de organiza√ß√£o ativa.
* Fase inicial pode ser **somente leitura** se o backend ainda n√£o expuser endpoint de update.

### Requisitos de implementa√ß√£o

1. Criar o componente de perfil

   * Local sugerido: `src/app/profile/profile.component.*`
     ou dentro de um m√≥dulo `settings/profile` se a arquitetura j√° prever isso.
   * Registrar rota protegida para a tela de perfil (ex.: `/profile`), usando `authCanMatch` apenas.

2. Consumir `CurrentUserStore`

   * Injetar `CurrentUserStore` no componente.
   * Expor os dados do usu√°rio (nome, e-mail, username, etc.) para o template.
   * Tratar estado de ‚Äúcarregando‚Äù caso o store ainda n√£o esteja pronto.

3. Renderizar a UI

   * Exibir os campos do usu√°rio de forma clara:

     * Nome
     * E-mail
     * Username/Login (se aplic√°vel)
   * Opcionalmente, preparar layout para modo edi√ß√£o (inputs + bot√£o ‚ÄúSave changes‚Äù), mesmo que o backend ainda n√£o exista.

4. (Opcional) Implementar edi√ß√£o

   * Criar formul√°rio reativo com campos edit√°veis suportados pelo backend.
   * Integrar com um servi√ßo de API de perfil (`UserProfileApiService`) para salvar as altera√ß√µes.
   * Ao salvar:

     * Atualizar o `CurrentUserStore` com o resultado.
     * Exibir mensagem de sucesso ou erro.

### Entreg√°veis

* Componente de perfil (`.ts`, `.html`, `.scss`) criado e integrado √†s rotas.
* Integra√ß√£o com `CurrentUserStore` para exibir os dados do usu√°rio.
* (Opcional) Integra√ß√£o com API de update para editar campos.
* Comportamento de acesso/navega√ß√£o alinhado com os crit√©rios de aceite.

Mostre os arquivos finais do componente de perfil e as altera√ß√µes de rota necess√°rias ap√≥s a implementa√ß√£o.
