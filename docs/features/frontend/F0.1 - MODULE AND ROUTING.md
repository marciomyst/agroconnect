# üß© F0.1 ‚Äî Module & Routing Architecture

## üéØ Objetivo

Definir a **arquitetura base de rotas e m√≥dulos do frontend Angular**, estabelecendo:

* Separa√ß√£o clara entre √°reas **Public**, **Farmer**, **Seller** e **Admin**
* Uso de **Standalone Routes (Angular moderno)**
* Controle de acesso por **canMatch**
* Prepara√ß√£o estrutural para autentica√ß√£o, roles e memberships
* Base s√≥lida para evolu√ß√£o incremental sem refatora√ß√µes estruturais

Esta feature **n√£o entrega UI nem l√≥gica de neg√≥cio** ‚Äî apenas o esqueleto arquitetural.

---

## üß≠ Motiva√ß√£o

O AgroConnect possui **perfis distintos de uso**:

* Usu√°rio an√¥nimo (marketplace p√∫blico)
* Farmer (comprador)
* Seller (vendedor)
* Admin (administrativo)

Sem uma arquitetura de rotas clara desde o in√≠cio:

* Bundles crescem desnecessariamente
* Guards ficam espalhados
* Autoriza√ß√£o vira acoplamento tardio
* A experi√™ncia multi-perfil degrada r√°pido

O F-Front 0.1 resolve isso **antes de qualquer feature funcional**.

---

## üì¶ Escopo

### Inclui

* Estrutura de pastas do frontend
* Defini√ß√£o de rotas raiz
* Lazy loading por √°rea
* Uso de `canMatch` para controle de acesso
* Defini√ß√£o dos *shells* (layout containers)
* Base para guards e store (sem implementa√ß√£o)

### N√£o inclui

* Autentica√ß√£o funcional
* Store de usu√°rio
* Chamada de API
* Componentes de neg√≥cio
* UI final

---

## üóÇÔ∏è Estrutura de Pastas

```text
src/app
 ‚îú‚îÄ‚îÄ core/                 # servi√ßos singleton, guards, interceptors
 ‚îú‚îÄ‚îÄ shared/               # componentes reutiliz√°veis (UI)
 ‚îú‚îÄ‚îÄ layout/               # shells (public / app)
 ‚îÇ    ‚îú‚îÄ‚îÄ public-layout.component.ts
 ‚îÇ    ‚îî‚îÄ‚îÄ app-layout.component.ts
 ‚îú‚îÄ‚îÄ public/               # marketplace p√∫blico
 ‚îÇ    ‚îî‚îÄ‚îÄ public.routes.ts
 ‚îú‚îÄ‚îÄ farmer/               # √°rea do agricultor
 ‚îÇ    ‚îî‚îÄ‚îÄ farmer.routes.ts
 ‚îú‚îÄ‚îÄ seller/               # √°rea do vendedor
 ‚îÇ    ‚îî‚îÄ‚îÄ seller.routes.ts
 ‚îú‚îÄ‚îÄ admin/                # √°rea administrativa
 ‚îÇ    ‚îî‚îÄ‚îÄ admin.routes.ts
 ‚îú‚îÄ‚îÄ app.routes.ts         # rotas raiz
 ‚îî‚îÄ‚îÄ app.component.ts
```

---

## üß© Arquitetura de Rotas

### Rotas Raiz (`app.routes.ts`)

```ts
export const APP_ROUTES: Routes = [
  {
    path: '',
    loadChildren: () =>
      import('./public/public.routes')
        .then(m => m.PUBLIC_ROUTES),
  },
  {
    path: 'farmer',
    canMatch: [authCanMatch, roleCanMatch('Farmer')],
    loadChildren: () =>
      import('./farmer/farmer.routes')
        .then(m => m.FARMER_ROUTES),
  },
  {
    path: 'seller',
    canMatch: [authCanMatch, roleCanMatch('Seller')],
    loadChildren: () =>
      import('./seller/seller.routes')
        .then(m => m.SELLER_ROUTES),
  },
  {
    path: 'admin',
    canMatch: [authCanMatch, roleCanMatch('Admin')],
    loadChildren: () =>
      import('./admin/admin.routes')
        .then(m => m.ADMIN_ROUTES),
  },
  { path: '**', redirectTo: '' },
];
```

> **Decis√£o-chave**: uso de `canMatch` para impedir at√© o carregamento do bundle quando o usu√°rio n√£o tem acesso.

---

## üß± Shells (Layouts)

### PublicLayout

Respons√°vel por:

* Header p√∫blico (busca, login, carrinho)
* Footer
* `<router-outlet>`

Usado apenas pelo m√≥dulo **Public**.

---

### AppLayout

Respons√°vel por:

* Header logado
* Menu lateral
* Seletor futuro de organiza√ß√£o
* `<router-outlet>`

Usado por:

* Farmer
* Seller
* Admin

---

## üîê Guards (contratos)

> **Implementa√ß√£o fica para F-Front 0.2**

### `authCanMatch`

* Verifica se o usu√°rio est√° autenticado
* Retorna `false` se n√£o houver sess√£o v√°lida

### `roleCanMatch(role)`

* Verifica se o usu√°rio possui o papel exigido
* Avalia√ß√£o baseada em **membership**, n√£o em role global

---

## üìè Regras Arquiteturais

1. **Public nunca depende de Farmer/Seller/Admin**
2. **Farmer/Seller/Admin s√≥ dependem de `core` e `shared`**
3. **Nenhuma feature acessa API diretamente**
4. **Lazy loading obrigat√≥rio por √°rea**
5. **Autoriza√ß√£o sempre na rota, nunca no componente**
6. **Shell define layout, n√£o l√≥gica**

---

## üö´ Fora de Escopo

* Organiza√ß√£o ativa
* Seletor de perfil
* Prote√ß√£o por feature interna
* UI final de navega√ß√£o

---

## ‚úÖ Checklist de Implementa√ß√£o

### Estrutura

* [ ] Criar pastas `public`, `farmer`, `seller`, `admin`
* [ ] Criar `core`, `shared`, `layout`

### Layout

* [ ] Criar `PublicLayoutComponent`
* [ ] Criar `AppLayoutComponent`

### Rotas

* [ ] Criar `public.routes.ts`
* [ ] Criar `farmer.routes.ts`
* [ ] Criar `seller.routes.ts`
* [ ] Criar `admin.routes.ts`
* [ ] Criar `app.routes.ts`

### Guards (contrato)

* [ ] Criar stubs de `authCanMatch`
* [ ] Criar stubs de `roleCanMatch`