# ğŸ›’ F3.3 â€” Marketplace Read Model (Backend)

## ğŸ¯ Objetivo

Implementar o **Read Model do Marketplace**, disponibilizando uma **visÃ£o unificada de consulta** que permita a Farmers e usuÃ¡rios autorizados **navegar por produtos e visualizar ofertas disponÃ­veis**, sem permitir qualquer mutaÃ§Ã£o de dados.

Esta feature consolida informaÃ§Ãµes de:

* Produtos globais (F3.1)
* Ofertas dos Sellers (F3.2)

em uma **camada de leitura otimizada**, preparando o terreno para pedidos e checkout nas fases seguintes.

---

## ğŸ§  Contexto

AtÃ© este ponto, a plataforma jÃ¡ possui:

* Produtos definidos de forma global
* Sellers com catÃ¡logos prÃ³prios e preÃ§os

Entretanto, **nÃ£o existe ainda uma visÃ£o de consumo unificada** que permita:

* Buscar produtos
* Comparar ofertas
* Navegar por categorias

O Marketplace Ã© **exclusivamente leitura**, nÃ£o sendo parte do domÃ­nio transacional.
Ele representa uma **projeÃ§Ã£o otimizada** para consumo por UI e APIs pÃºblicas.

---

## ğŸ“¦ Escopo

### ğŸ“Œ Natureza da Feature

* **Read-only**
* Sem Aggregate Roots
* Sem comandos
* Sem regras de negÃ³cio mutÃ¡veis
* NÃ£o participa de transaÃ§Ãµes de escrita

---

### ğŸ“Š Read Models

#### `MarketplaceProductListItem`

Representa um produto na listagem do marketplace.

* `ProductId`
* `Name`
* `Category`
* `IsControlledByRecipe`
* `BestPrice` (menor preÃ§o entre ofertas disponÃ­veis)
* `HasAvailableOffers`

---

#### `MarketplaceProductOfferItem`

Representa uma oferta especÃ­fica para um produto.

* `SellerId`
* `SellerName`
* `Price`
* `Currency`
* `IsAvailable`

---

### ğŸ”Œ Endpoints

#### Listar Produtos do Marketplace

```
GET /api/marketplace/products
```

**Query Params:**

* `search` (opcional)
* `category` (opcional)
* `page`
* `pageSize`

**Comportamento:**

* Retorna apenas produtos com **ao menos uma oferta disponÃ­vel**
* Suporte a paginaÃ§Ã£o
* Busca textual por nome
* Filtro por categoria

---

#### Listar Ofertas de um Produto

```
GET /api/marketplace/products/{productId}/offers
```

**Comportamento:**

* Retorna todas as ofertas disponÃ­veis para o produto
* Inclui informaÃ§Ãµes resumidas do Seller
* NÃ£o retorna ofertas inativas

---

### ğŸ§© Application Layer

* Queries:

  * `SearchMarketplaceProductsQuery`
  * `GetMarketplaceProductOffersQuery`
* Query Handlers:

  * Implementados de forma isolada (Vertical Slice)
* DTOs especÃ­ficos de leitura
* Nenhuma dependÃªncia de `IUnitOfWork` para escrita

---

### ğŸ—„ï¸ Infraestrutura

* Queries realizadas via:

  * EF Core (projeÃ§Ãµes diretas)
  * ou Dapper (opcional, se adotado para leitura)
* Sem tracking (`AsNoTracking`)
* Ãndices esperados:

  * `products.Name`
  * `products.Category`
  * `seller_products.ProductId`
  * `seller_products.IsAvailable`

---

## ğŸ“ Regras de Consulta

* Produtos sem ofertas disponÃ­veis **nÃ£o aparecem** na listagem
* Ofertas inativas **nÃ£o sÃ£o retornadas**
* Marketplace **nÃ£o altera estado** de nenhuma entidade
* Nenhuma validaÃ§Ã£o de escrita ocorre nesta camada

---

## ğŸš« Fora de Escopo

* Carrinho
* Pedido
* Pagamento
* Reserva de estoque
* NegociaÃ§Ã£o de preÃ§o
* PersonalizaÃ§Ã£o por regiÃ£o ou perfil do Farmer
* Ranking avanÃ§ado de Sellers

---

## âœ… CritÃ©rios de Aceite

* Endpoint de listagem retorna produtos com ofertas disponÃ­veis
* Endpoint de ofertas retorna apenas ofertas ativas
* Busca e filtro funcionam corretamente
* PaginaÃ§Ã£o respeitada
* Nenhuma operaÃ§Ã£o de escrita Ã© possÃ­vel via marketplace
* CÃ³digo segue padrÃ£o CQRS (Read Model)
* Performance aceitÃ¡vel em listas paginadas
* Nenhuma dependÃªncia direta com Frontend

---

## ğŸ§­ ObservaÃ§Ãµes TÃ©cnicas

* Marketplace **nÃ£o Ã© Aggregate Root**
* Queries nÃ£o devem reutilizar entidades de escrita
* DTOs de leitura nÃ£o expÃµem detalhes internos de domÃ­nio
* Esta feature depende diretamente de:

  * F3.1 â€” Product Catalog Core
  * F3.2 â€” Seller Catalog & Offers
* Serve de base para:

  * F4.x â€” Carrinho e Pedido
  * F5.x â€” RecomendaÃ§Ãµes e inteligÃªncia comercial