# ğŸŒ F3.6 â€” Marketplace Backend API & Integration

## ğŸ¯ Objetivo

Expor via **API HTTP** todas as capacidades implementadas na Fase 3 (Marketplace), conectando os comandos e queries existentes da Application Layer a endpoints seguros, coerentes e prontos para consumo pelo frontend.

Esta feature transforma o backend F3.x em um **backend funcional de marketplace**, mantendo separaÃ§Ã£o clara entre domÃ­nio, aplicaÃ§Ã£o e API.

---

## ğŸ§  Contexto

Com a F3.5 concluÃ­da, o backend jÃ¡ possui:

* PersistÃªncia funcional
* RepositÃ³rios concretos
* Read models disponÃ­veis

A F3.6 cria a **superfÃ­cie de integraÃ§Ã£o**, respeitando:

* Contexto de organizaÃ§Ã£o ativa
* Roles por tipo de organizaÃ§Ã£o (Farm / Seller)
* Contratos estÃ¡veis para o frontend

---

## ğŸ“¦ Escopo

### ğŸ“Œ Products API

Endpoints:

* `POST /api/products`
* `GET /api/products/{productId}`
* `GET /api/products?search=&category=&page=&pageSize=`

Regras:

* CriaÃ§Ã£o restrita a roles administrativas (se aplicÃ¡vel)
* Leitura permitida para usuÃ¡rios autenticados

---

### ğŸ“Œ Seller Catalog API

Endpoints:

* `GET /api/sellers/{sellerId}/catalog`
* `POST /api/sellers/{sellerId}/catalog`
* `PUT /api/sellers/{sellerId}/catalog/{sellerProductId}`

Regras:

* `sellerId` validado contra organizaÃ§Ã£o ativa
* Roles permitidas:

  * `SellerOwner`
  * `SellerManager`

---

### ğŸ“Œ Marketplace API (Read-Only)

Endpoints:

* `GET /api/marketplace/products`
* `GET /api/marketplace/products/{productId}/offers`

Regras:

* Acesso restrito a usuÃ¡rios com organizaÃ§Ã£o ativa do tipo **Farm**
* Nenhuma mutaÃ§Ã£o permitida

---

### ğŸ“Œ Purchase Intent API

Endpoints:

* `POST /api/purchase-intents`
* `GET /api/me/purchase-intents`
* `GET /api/me/seller/purchase-intents`
* `PUT /api/purchase-intents/{purchaseIntentId}/status`

Regras:

* CriaÃ§Ã£o:

  * Contexto Farm
  * Roles: `FarmOwner`, `FarmBuyer`
* AtualizaÃ§Ã£o de status:

  * Contexto Seller
  * Roles: `SellerOwner`, `SellerManager`
* Status vÃ¡lidos:

  * `Accepted`
  * `Rejected`

---

### ğŸ“Œ IntegraÃ§Ã£o com Application Layer

* Todos os endpoints devem:

  * Criar Commands/Queries
  * Invocar handlers existentes
  * Tratar exceÃ§Ãµes de domÃ­nio e autorizaÃ§Ã£o
* NÃ£o duplicar regras de negÃ³cio na API

---

### ğŸ“Œ SeguranÃ§a e AutorizaÃ§Ã£o

* Uso obrigatÃ³rio de:

  * Auth middleware
  * Contexto de organizaÃ§Ã£o ativa
* Nenhuma operaÃ§Ã£o deve aceitar `FarmId` ou `SellerId` arbitrÃ¡rio sem validaÃ§Ã£o

---

## ğŸš« Fora de Escopo

* Frontend
* Jobs de expiraÃ§Ã£o
* Feature flags
* Testes automatizados
* Observabilidade avanÃ§ada

---

## âœ… CritÃ©rios de Aceite

* Todos os endpoints F3.x disponÃ­veis via API
* Contratos coerentes com os handlers existentes
* AutorizaÃ§Ã£o aplicada corretamente por contexto e role
* Nenhuma regressÃ£o em APIs existentes
* APIs testÃ¡veis via Swagger/Postman
* Backend pronto para consumo pelo frontend F3.x