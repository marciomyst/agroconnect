## üéØ Objetivo do F2.1 ‚Äî RegisterSellerWithOwner

Criar a **feature de cadastro de Seller com Owner**, respons√°vel por:

* Registrar uma nova **Seller (Revenda)** no sistema
* Criar o v√≠nculo inicial entre um **User** e a **Seller**
* Atribuir o papel **SellerRole.Owner**
* Garantir invariantes de dom√≠nio
* Disparar eventos de dom√≠nio oficiais

Sem:

* violar CQRS
* acoplar dom√≠nio a infraestrutura
* criar conceitos fora da Linguagem Ub√≠qua
* criar eventos n√£o catalogados

---

## üìÅ Estrutura de pastas / namespaces

### Domain

Em `Agronomia.Domain`:

```text
Agronomia.Domain
 ‚îî‚îÄ‚îÄ Organizations
     ‚îî‚îÄ‚îÄ Seller.cs

Agronomia.Domain
 ‚îî‚îÄ‚îÄ Memberships
     ‚îú‚îÄ‚îÄ SellerMembership.cs
     ‚îî‚îÄ‚îÄ SellerRole.cs
```

Namespaces sugeridos:

```csharp
namespace Agronomia.Domain.Organizations;
namespace Agronomia.Domain.Memberships;
```

---

### Application

Em `Agronomia.Application`:

```text
Agronomia.Application
 ‚îî‚îÄ‚îÄ Features
     ‚îî‚îÄ‚îÄ Sellers
         ‚îî‚îÄ‚îÄ RegisterSellerWithOwner
             ‚îú‚îÄ‚îÄ RegisterSellerWithOwnerCommand.cs
             ‚îú‚îÄ‚îÄ RegisterSellerWithOwnerResult.cs
             ‚îú‚îÄ‚îÄ RegisterSellerWithOwnerHandler.cs
             ‚îî‚îÄ‚îÄ RegisterSellerWithOwnerValidator.cs
```

---

### Api

Em `Agronomia.Api`:

```text
Agronomia.Api
 ‚îî‚îÄ‚îÄ Features
     ‚îî‚îÄ‚îÄ Sellers
         ‚îî‚îÄ‚îÄ RegisterSellerWithOwner
             ‚îú‚îÄ‚îÄ RegisterSellerWithOwnerEndpoint.cs
             ‚îî‚îÄ‚îÄ RegisterSellerWithOwnerHttpRequest.cs
```

---

## 1. Aggregate `Seller`

### 1.1. Objetivo

Representar a **organiza√ß√£o Seller (Revenda)** dentro do dom√≠nio.

---

### 1.2. Responsabilidades

* Manter identidade da Seller
* Proteger invariantes de cria√ß√£o
* Levantar o evento `SellerRegistered`

---

### 1.3. Propriedades essenciais

* `SellerId` (Guid)
* `TaxId` (string ou VO futuro)
* `CorporateName` (string)

---

### 1.4. Regras de cria√ß√£o

* `TaxId` obrigat√≥rio
* `CorporateName` obrigat√≥rio
* Cria√ß√£o ocorre **exclusivamente via m√©todo de f√°brica**
* Ao ser criada, **sempre** dispara `SellerRegistered`

---

### 1.5. Evento levantado

```text
SellerRegistered
```

Payload m√≠nimo (conforme cat√°logo oficial):

* SellerId
* TaxId
* CorporateName

---

## 2. Aggregate `SellerMembership`

### 2.1. Objetivo

Representar o **v√≠nculo entre um User e uma Seller**.

---

### 2.2. Responsabilidades

* Garantir v√≠nculo contextual (User ‚Üî Seller)
* Definir papel do User dentro da Seller
* Levantar o evento `SellerMembershipGranted`

---

### 2.3. Propriedades essenciais

* `SellerMembershipId` (Guid)
* `SellerId` (Guid)
* `UserId` (Guid)
* `Role` (`SellerRole`)

---

### 2.4. Regras de cria√ß√£o

* `SellerId` obrigat√≥rio
* `UserId` obrigat√≥rio
* Papel inicial **sempre** `SellerRole.Owner`
* Cria√ß√£o ocorre via f√°brica
* Dispara `SellerMembershipGranted`

---

### 2.5. Evento levantado

```text
SellerMembershipGranted
```

Payload m√≠nimo:

* SellerId
* UserId
* Role

---

## 3. Enum `SellerRole`

### 3.1. Objetivo

Definir pap√©is poss√≠veis de um User dentro de uma Seller.

---

### 3.2. Valores iniciais (normativos)

```text
Owner
Manager
Viewer
```

> Conforme Linguagem Ub√≠qua ‚Äî Agronomia

---

## 4. Command `RegisterSellerWithOwner`

### 4.1. Objetivo

Expressar a **inten√ß√£o de registrar uma Seller** e atribuir o User autenticado como Owner.

---

### 4.2. Dados carregados

* `UserId` ‚Äî identidade vinda do JWT
* `TaxId`
* `CorporateName`

---

### 4.3. Assinatura conceitual

```text
RegisterSellerWithOwnerCommand
```

Retorna:

```text
RegisterSellerWithOwnerResult
```

---

## 5. Handler `RegisterSellerWithOwnerHandler`

### 5.1. Responsabilidade

Orquestrar a cria√ß√£o da Seller e do SellerMembership de forma **at√¥mica**.

---

### 5.2. Fluxo l√≥gico

1. Validar Command
2. Verificar se j√° existe Seller com o mesmo `TaxId`
3. Criar Aggregate `Seller`
4. Criar Aggregate `SellerMembership` com `SellerRole.Owner`
5. Persistir ambos via reposit√≥rios de escrita
6. Commit da Unit of Work
7. Retornar IDs criados

---

### 5.3. Reposit√≥rios envolvidos (write model)

* `ISellerRepository`
* `ISellerMembershipRepository`

---

## 6. Validator `RegisterSellerWithOwnerValidator`

### 6.1. Objetivo

Validar **entrada de dados**, n√£o regras de neg√≥cio complexas.

---

### 6.2. Regras m√≠nimas

* `UserId` ‚â† vazio
* `TaxId` ‚â† null / empty
* `CorporateName` ‚â† null / empty

---

## 7. Endpoint HTTP

### 7.1. Rota

```text
POST /api/sellers
```

---

### 7.2. Request HTTP

```text
RegisterSellerWithOwnerHttpRequest
```

Campos:

* `TaxId`
* `CorporateName`

---

### 7.3. Response HTTP

Retorno em caso de sucesso:

* `201 Created`
* `SellerId`
* `SellerMembershipId`

Erros esperados:

* `400` ‚Äî valida√ß√£o
* `409` ‚Äî Seller com `TaxId` j√° existente

---

## 8. Eventos de Dom√≠nio envolvidos

Eventos **j√° existentes e normativos**:

* `SellerRegistered`
* `SellerMembershipGranted`

‚ö†Ô∏è Nenhum evento novo √© criado no F2.1.

---

## 9. Regras expl√≠citas do F2.1

1. Apenas Aggregates levantam eventos
2. `Seller` e `SellerMembership` **n√£o se referenciam diretamente**
3. Autentica√ß√£o **n√£o √© responsabilidade** desta feature
4. Pap√©is **n√£o v√£o no JWT**
5. Persist√™ncia apenas via write model (EF Core)
6. Queries futuras usar√£o Dapper (fora do escopo do F2.1)